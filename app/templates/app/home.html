{% extends 'app/base.html' %}
{% load static %}
{% load humanize %}

{% block banner_slider %}
<!-- Banner -->
<div class="container mt-4">
  <div class="row justify-content-center text-center">
    <div class="col-12 d-flex justify-content-center flex-wrap gap-3">
      <div class="banner-img">
        <img src="{% static 'app/images/banner/Banner1.png' %}" class="img-fluid rounded shadow-sm" alt="Banner 1" style="max-height: 250px;">
      </div>
      <div class="banner-img">
        <img src="{% static 'app/images/banner/banner2.png' %}" class="img-fluid rounded shadow-sm" alt="Banner 2" style="max-height: 250px;">
      </div>
      <div class="banner-img">
        <img src="{% static 'app/images/banner/banner3.png' %}" class="img-fluid rounded shadow-sm" alt="Banner 3" style="max-height: 250px;">
      </div>
    </div>
  </div>
</div>
<hr style="border: none; border-top: 3px solid #ff5722; width: 100%; margin: 20px 0;">
{% endblock banner_slider %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'app/css/home.css' %}?v=3">
{% endblock extra_css %}
{% block extra_js %}
<script src="{% static 'js/home.js' %}"></script>
<script>
  // H√†m t·∫°o ph·∫ßn trƒÉm gi·∫£m gi√° ng·∫´u nhi√™n
  function getRandomDiscount() {
    return Math.floor(Math.random() * 46) + 5;  // Gi·∫£m gi√° ng·∫´u nhi√™n t·ª´ 5% ƒë·∫øn 50%
  }

  // H√†m b·∫Øt ƒë·∫ßu ƒë·∫øm ng∆∞·ª£c flash sale
  function startFlashSaleCountdown(durationInSeconds) {
    let timer = durationInSeconds;
    const timerDisplay = document.getElementById("flash-sale-timer");

    if (!timerDisplay) {
      console.error("Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ v·ªõi id 'flash-sale-timer'");
      return;
    }

    const countdown = setInterval(() => {
      const hours = String(Math.floor(timer / 3600)).padStart(2, '0');
      const minutes = String(Math.floor((timer % 3600) / 60)).padStart(2, '0');
      const seconds = String(timer % 60).padStart(2, '0');

      timerDisplay.textContent = `${hours}:${minutes}:${seconds}`;

      if (--timer < 0) {
        clearInterval(countdown);
        timerDisplay.textContent = "00:00:00";
      }
    }, 1000);
  }

  document.addEventListener("DOMContentLoaded", function () {
    startFlashSaleCountdown(10800);  // ƒê·∫øm ng∆∞·ª£c 3 gi·ªù (10800 gi√¢y)

    // Th√™m ph·∫ßn trƒÉm gi·∫£m gi√° ng·∫´u nhi√™n cho m·ªói s·∫£n ph·∫©m
    const flashSaleProducts = document.querySelectorAll('.flash-sale-card');
    flashSaleProducts.forEach(function (product) {
      const discount = getRandomDiscount();
      const discountElement = document.createElement('div');
      discountElement.classList.add('discount-label');
      discountElement.textContent = `${discount}%`;  // Ch·ªâ hi·ªÉn th·ªã ph·∫ßn trƒÉm gi·∫£m gi√°

      // Th√™m v√†o b√™n trong wrapper s·∫£n ph·∫©m
      const imageWrapper = product.querySelector('.product-image-wrapper');
      if (imageWrapper) {
        imageWrapper.appendChild(discountElement);
      }
    });
  });
</script>
{% endblock extra_js %}

{% block main-content %}
<!--Danh muc-->
<div class="container my-4">
  <h5 class="fw-bold mb-3 text-center">DANH M·ª§C</h5>
  <div class="row row-cols-2 row-cols-sm-3 row-cols-md-5 g-3 text-center">
    <div class="col">
      <a href="{% url 'category' %}?category=dien-thoai" class="text-decoration-none text-dark">
        <i class="fas fa-mobile-alt fa-2x mb-2" style="color: #007bff;"></i>
        <div>ƒêi·ªán Tho·∫°i</div>
      </a>
    </div>
    <div class="col">
      <a href="{% url 'category' %}?category=tai-nghe" class="text-decoration-none text-dark">
        <i class="fa-solid fa-headphones fa-2x mb-2" style="color: #6610f2;"></i>
        <div>Tai nghe</div>
      </a>
    </div>
    <div class="col">
      <a href="{% url 'category' %}?category=do-dung-hoc-tap" class="text-decoration-none text-dark">
        <i class="fas fa-book fa-2x mb-2" style="color: #20c997;"></i>
        <div>ƒê·ªì d√πng h·ªçc t·∫≠p</div>
      </a>
    </div>
    <div class="col">
      <a href="{% url 'category' %}?category=ghe" class="text-decoration-none text-dark">
        <i class="fa-solid fa-chair fa-2x mb-2" style="color: #fd7e14;"></i>
        <div>Gh·∫ø</div>
      </a>
    </div>
    <div class="col">
      <a href="{% url 'category' %}?category=dong-ho" class="text-decoration-none text-dark">
        <i class="fas fa-clock fa-2x mb-2" style="color: #ffc107;"></i>
        <div>ƒê·ªìng H·ªì</div>
      </a>
    </div>
    <div class="col">
      <a href="{% url 'category' %}?category=quan-ao" class="text-decoration-none text-dark">
        <i class="fas fa-tshirt fa-2x mb-2" style="color: #dc3545;"></i>
        <div>Qu·∫ßn √°o</div>
      </a>
    </div>
    <div class="col">
      <a href="{% url 'category' %}?category=trang-tri" class="text-decoration-none text-dark">
        <i class="fas fa-star fa-2x mb-2" style="color: #f0ad4e;"></i>
        <div>Trang tr√≠</div>
      </a>
    </div>
    <div class="col">
      <a href="{% url 'category' %}?category=the-thao" class="text-decoration-none text-dark">
        <i class="fas fa-football-ball fa-2x mb-2" style="color: #28a745;"></i>
        <div>Th·ªÉ thao</div>
      </a>
    </div>
    <div class="col">
      <a href="{% url 'category' %}?category=do-choi" class="text-decoration-none text-dark">
        <i class="fa-solid fa-baby fa-2x mb-2" style="color: #e83e8c;"></i>
        <div>ƒê·ªì ch∆°i</div>
      </a>
    </div>
    <div class="col">
      <a href="{% url 'category' %}?category=giay-dep" class="text-decoration-none text-dark">
        <i class="fas fa-shoe-prints fa-2x mb-2" style="color: #6c757d;"></i>
        <div>Gi√†y D√©p</div>
      </a>
    </div>
  </div>
</div>
<hr style="border-top: 3px solid red; margin: 2rem 0;">
<!-- Flash sale -->
<section class="flash-sale">
  <div class="flash-sale-header">
    <h2>üî• FLASH SALE <span id="flash-sale-timer">00:00:00</span></h2>
  </div>

  <div class="flash-sale-products">
    {% for product in flash_sale_products %}
      <a href="{% url 'detail' product.id %}" class="text-decoration-none text-dark">
        <div class="flash-sale-card position-relative">

          <div class="product-image-wrapper position-relative">
            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="img-fluid">
            
            {% if product.discount_percent %}
              <div class="discount-label ">
                -{{ product.discount_percent }}%
              </div>
            {% endif %}
          </div>

          <div class="flash-sale-info text-center mt-2">
            <p class="price fw-bold text-danger mb-1">
              {{ product.sale_price|intcomma }}‚Ç´
            </p>
            <p class="text-muted small" style="text-decoration: line-through;">
              {{ product.price|intcomma }}‚Ç´
            </p>
            <div class="flash-sale-label small text-danger">ƒêANG B√ÅN CH·∫†Y</div>
          </div>

        </div>
      </a>
    {% endfor %}
  </div>
</section>
<!-- G·ª£i √Ω h√¥m nay -->
<div class="suggest-title-container text-center py-3">
  <h5 class="suggest-title">G·ª¢I √ù H√îM NAY</h5>
  <div style="width: 100%; height: 4px; background: linear-gradient(to right, transparent, #e74c3c, transparent); margin: 0 auto 20px auto;"></div>
</div>

<!--S·∫£n ph·∫©m-->
<div class="container my-4">
  <div class="row justify-content-center">
    {% for product in products %}
    <div class="col-2 col-sm-2 col-md-2 col-lg-2 mb-4">  <!-- ƒêi·ªÅu ch·ªânh s·ªë c·ªôt -->
      <div class="product-card text-center">
        <a href="{% url 'detail' product.id %}" class="text-decoration-none text-dark">
          <div class="product-image-wrapper mb-2">
            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="img-fluid rounded">
          </div>
          <div class="product-info">
            <div class="product-name fw-bold">{{ product.name }}</div>
            <div class="product-meta small text-muted">
              <div class="price">{{ product.price|intcomma }}‚Ç´</div>
              <div class="sold">ƒê√£ b√°n {{ sold_count|default:"5k" }}</div>
            </div>
          </div>
        </a>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
<br><br><br>
{% endblock main-content %}

